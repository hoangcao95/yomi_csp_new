<!DOCTYPE html>
<html>
	<head th:replace="fragments/init :: head">
   		<title>Title List</title>
 	</head>
   	<link href="../../../resources/bootstrap3-dialog/dist/css/bootstrap-dialog.min.css" rel="stylesheet"  th:href="@{/resources/bootstrap3-dialog/dist/css/bootstrap-dialog.min.css}"/>
    <body>
        <div id="wrapper">
            <div id="nav_id" th:replace="nav :: nav">
                <nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="margin-bottom: 0">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="index.html">SB Admin v2.0</a>
                    </div>
                    <!-- /.navbar-header -->

                    <ul class="nav navbar-top-links navbar-right">
                    </ul>
                    <!-- /.navbar-top-links -->

                    <div class="navbar-default navbar-static-side" role="navigation">
                    </div>
                    <!-- /.navbar-static-side -->
                </nav>
            </div>
            <div id="page-wrapper" style="min-height: 600px;">
                <div class="row" style="padding-top: 30px;">
                    <div class="col-lg-6">
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                Tham số hệ thống
                                <div class="btn-group pull-right">
									<a id = "btnRefresh" href="#" th:href="@{/report/queues.html}"><i class="fa fa-refresh fa-2x"></i></a>
	                            </div>
                            </div>
                            <!-- /.panel-heading -->
                            <div class="panel-body">
                                <div class="table-responsive">
                                    <table id="table-question" class="table table-striped table-bordered table-hover dataTable">
                                        <thead>
                                            <tr>
                                                <th>Param</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:if="${mtQueue} != null">
                                                <td th:text="${mtQueue.key}"></td>
                                                <td id="mtQueueSize" th:text="${mtQueue.value}"></td>
                                            </tr>
                                            <tr th:if="${mtContentQueue} != null">
                                                <td th:text="${mtContentQueue.key}"></td>
                                                <td id="mtContentQueueSize" th:text="${mtContentQueue.value}"></td>
                                            </tr>
                                            <tr th:if="${mtQueueSMSC} != null">
                                                <td th:text="${mtQueueSMSC.key}"></td>
                                                <td id="mtQueueSMSCSize" th:text="${mtQueueSMSC.value}"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- /.table-responsive -->
                            </div>
                            <!-- /.panel-body -->
                        </div>
                        <!-- /.panel -->
                    </div>
					<div class="col-lg-6">
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                Tham số hệ thống
                                <div class="btn-group pull-right">
									<a id = "btnClearMaxTpsQueue" sec:authorize="hasAnyAuthority('Administrators','ThreadManagers')" href="#"><i class="fa fa-gear fa-2x"></i></a>
                                		<span>&nbsp;</span>
									<a id = "btnRefresh" href="#" th:href="@{/report/queues.html}"><i class="fa fa-refresh fa-2x"></i></a>
	                            </div>
                            </div>
                            <!-- /.panel-heading -->
                            <div class="panel-body">
                                <div class="table-responsive">
                                    <table id="table-question" class="table table-striped table-bordered table-hover dataTable">
                                        <thead>
                                            <tr>
                                                <th>Param</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:if="${maxTpsQueue} != null">
                                                <td th:text="${maxTpsQueue.key}"></td>
                                                <td id="maxTpsQueueSize" th:text="${maxTpsQueue.value}"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- /.table-responsive -->
                            </div>
                            <!-- /.panel-body -->
                        </div>
                        <!-- /.panel -->
                    </div>
                    <!-- /.col-lg-6 -->
				</div>
				<!-- row -->
            </div>
            <!-- /#page-wrapper -->
        </div>
        <!-- /#wrapper -->

		<div th:replace="fragments/init :: commonScript"></div>
		<!-- Core Scripts - Include with every page -->
        <script src="../../resources/sb-admin-v2/js/jquery-1.10.2.js" th:src="@{/resources/sb-admin-v2/js/jquery-1.10.2.js}"></script>
        <script src="../../resources/sb-admin-v2/js/bootstrap.min.js" th:src="@{/resources/sb-admin-v2/js/bootstrap.min.js}"></script>
        <script src="../../resources/sb-admin-v2/js/bootstrap-switch.js" th:src="@{/resources/sb-admin-v2/js/bootstrap-switch.js}"></script>
        <script src="../../resources/sb-admin-v2/js/plugins/metisMenu/jquery.metisMenu.js" th:src="@{/resources/sb-admin-v2/js/plugins/metisMenu/jquery.metisMenu.js}"></script>
        <script src="../../../resources/bootstrap3-dialog/dist/js/bootstrap-dialog.min.js" th:src="@{/resources/bootstrap3-dialog/dist/js/bootstrap-dialog.min.js}"></script>
        <!-- Page-Level Plugin Scripts - Dashboard -->
        <script src="../../resources/sb-admin-v2/js/plugins/morris/raphael-2.1.0.min.js" th:src="@{/resources/sb-admin-v2/js/plugins/morris/raphael-2.1.0.min.js}"></script>
        <script src="../../resources/sb-admin-v2/js/plugins/morris/morris.js" th:src="@{/resources/sb-admin-v2/js/plugins/morris/morris.js}"></script>
        <!-- Page-Level Plugin Scripts - Tables -->
        <script src="../../resources/sb-admin-v2/js/plugins/dataTables/jquery.dataTables.js" th:src="@{/resources/sb-admin-v2/js/plugins/dataTables/jquery.dataTables.js}"></script>

		<link rel="stylesheet" type="text/css" media="all" href="bootstrap-daterangepicker/daterangepicker-bs3.css" th:href="@{/resources/bootstrap-daterangepicker/daterangepicker-bs3.css}"/>
		<script type="text/javascript" src="bootstrap-daterangepicker/moment.js" th:src="@{/resources/bootstrap-daterangepicker/moment.js}"></script>
		<script type="text/javascript" src="bootstrap-daterangepicker/daterangepicker.js" th:src="@{/resources/bootstrap-daterangepicker/daterangepicker.js}"></script>
	    <script th:inline="javascript">
	    	/*<![CDATA[*/
	    		var currUrl = /*[[@{/}]]*/ "";
	    	/*]]>*/
		</script>
        <script>
	        	function clearQueue() {
	        		BootstrapDialog.show({
						title: 'Xác nhận',
			            message: 'Xóa toàn bộ phần tử khỏi queue maxTps.',
			            buttons: [{
			                label: 'Bỏ qua',
			                action: function(dialogItself){
			                    dialogItself.close();
			                }
			            },{
			                label: 'Duyệt',
			                // no title as it is optional
			                cssClass: 'btn-primary',
			                data: {
			                },
			                action: function(dialogItself){
					        		var reqUrl = currUrl + "/report/clearQueues.html";
					        		$.ajax({
					        			type: "POST",
					    			    url: reqUrl,
					    			    data: {
					    			    },
					    			    success: function( response ) {
					    			    		var obj = JSON.parse(response);
					    			    		if (obj.status == '0') {
					    			    			$('#maxTpsQueueSize').html(obj.data['topupQueue-size-after']);										
										}
					    			    		dialogItself.close();
					    			    }
					    			});
			                }
			            }]
	        		});
	        	};
	        	
	        	function exportTopupQueue() {
	        		BootstrapDialog.show({
						title: 'Xác nhận',
			            message: 'Xuất dữ liệu topupQueue ra file? (Vui lòng dừng toàn bộ tiến trình mời để không gửi lặp KH.)',
			            buttons: [{
			                label: 'Bỏ qua',
			                action: function(dialogItself){
			                    dialogItself.close();
			                }
			            },{
			                label: 'Đồng ý',
			                // no title as it is optional
			                cssClass: 'btn-primary',
			                data: {
			                },
			                action: function(dialogItself){
					        		var reqUrl = currUrl + "/export/topup_queue_to_file";
					        		dialogItself.close();
			                }
			            }]
	        		});
	        	};
        	
	        $(document).ready(function() {
		        	$(function () {
		        	    //var token = $("meta[name='_csrf']").val();
		        	    var token = $("meta[name='_csrf']").attr("content");
		        	    var header = "X-CSRF-TOKEN";
		        	    $(document).ajaxSend(function(e, xhr, options) {
		        	        xhr.setRequestHeader(header, token);
		        	    });
		        	});
		        	$('#btnClearMaxTpsQueue').bind('click', function(event) {
		        		clearQueue();
				});
	        });
        </script>
    </body>

</html>
